<%= javascript_tag do %>
  var width = window.screen.availWidth;
  var width = window.screen.availHeight;
<% end %>

<div style='width: 1440px;'>
  <div id="map" style='width: 1440px; height: 700px;'></div>
</div>

<%= Geocoder.search(request.remote_ip.to_s).first.latitude %>
,
<%= Geocoder.search(request.remote_ip.to_s).first.longitude %>
<br>
<%= request.env["HTTP_X_FORWARDED_FOR"].try(:split, ',').try(:first) || request.env["REMOTE_ADDR"] %>

<%= javascript_tag do %>
	handler = Gmaps.build('Google');
  handler.buildMap(
    {internal: {id: 'map'}},
    function(){
      handler.map.centerOn([<%= latitude(request.location.latitude) %>, <%= longitude(request.location.longitude) %>]);
      handler.getMap().setZoom(8);

      markers = handler.addMarkers(<%=raw @hash.to_json %>);

      handler.bounds.extendWith(markers);
	    handler.fitMapToBounds();
    });

<% end %>
